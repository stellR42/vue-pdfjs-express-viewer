/** Notice * This file contains works from many authors under various (but compatible) licenses. Please see core.txt for more information. **/
(function(){(window.wpCoreControlsBundle=window.wpCoreControlsBundle||[]).push([[22],{341:function(Ca,va,aa){aa.r(va);var pa=aa(2),ja=aa(13),la=aa(1);Ca=aa(44);var fa=aa(31),ca=aa(9);aa=function(){function z(){this.init()}z.prototype.init=function(){this.IV=!1;this.se=this.Hi=this.connection=null;this.bo={};this.Da=this.bz=null};z.prototype.k8=function(w){for(var r=this,b=0;b<w.length;++b){var a=w[b];switch(a.at){case "create":this.bo[a.author]||(this.bo[a.author]=a.aName);this.q0(a);break;case "modify":this.Da.Wo(a.xfdf).then(function(e){r.Da.PN(e[0])});
break;case "delete":this.Da.Wo("<delete><id>"+a.aId+"</id></delete>")}}};z.prototype.q0=function(w){var r=this;this.Da.Wo(w.xfdf).then(function(b){b=b[0];b.authorId=w.author;r.Da.PN(b);r.Da.trigger(ja.a.UPDATE_ANNOTATION_PERMISSION,[b])})};z.prototype.T_=function(w,r,b){this.Hi&&this.Hi(w,r,b)};z.prototype.preloadAnnotations=function(w){this.addEventListener("webViewerServerAnnotationsEnabled",this.T_.bind(this,w,"add",{imported:!1}),{once:!0})};z.prototype.initiateCollaboration=function(w,r,b){var a=
this;if(w){a.se=r;a.Da=b.Ga();b.addEventListener(ja.c.DOCUMENT_UNLOADED,function(){a.disableCollaboration()});a.F8(w);var e=new XMLHttpRequest;e.addEventListener("load",function(){if(200===e.status&&0<e.responseText.length)try{var f=JSON.parse(e.responseText);a.connection=exports.ab.m9(Object(fa.h)(a.se,"blackbox/"),"annot");a.bz=f.id;a.bo[f.id]=f.user_name;a.Da.NO(f.id);a.connection.gF(function(x){x.t&&x.t.startsWith("a_")&&x.data&&a.k8(x.data)},function(){a.connection.send({t:"a_retrieve",dId:w});
a.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_ENABLED,[a.bo[f.id],a.bz])},function(){a.disableCollaboration()})}catch(x){Object(la.f)(x.message)}});e.open("GET",Object(fa.h)(this.se,"demo/SessionInfo.jsp"));e.withCredentials=!0;e.send();a.IV=!0;a.Da.T5(function(f){return a.bo[f.Author]||f.Author})}else Object(la.f)("Document ID required for collaboration")};z.prototype.disableCollaboration=function(){this.Hi&&(this.Da.removeEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Hi),this.Hi=null);this.connection&&
this.connection.CB();this.Da&&this.Da.NO("Guest");this.init();this.trigger(z.Events.WEBVIEWER_SERVER_ANNOTATIONS_DISABLED)};z.prototype.F8=function(w){var r=this;this.Hi&&this.Da.removeEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Hi);this.Hi=function(b,a,e){return Object(pa.b)(this,void 0,void 0,function(){var f,x,n,h,y,ba,ka,ha,ia;return Object(pa.d)(this,function(ea){switch(ea.label){case 0:if(e.imported)return[2];f={t:"a_"+a,dId:w,annots:[]};return[4,r.Da.qY()];case 1:x=ea.ia();"delete"!==
a&&(n=(new DOMParser).parseFromString(x,"text/xml"),h=new XMLSerializer);for(y=0;y<b.length;y++)ba=b[y],ha=ka=void 0,"add"===a?(ka=n.querySelector('[name="'+ba.Id+'"]'),ha=h.serializeToString(ka),ia=null,ba.InReplyTo&&(ia=r.Da.aK(ba.InReplyTo).authorId||"default"),f.annots.push({at:"create",aId:ba.Id,author:r.bz,aName:r.bo[r.bz],parent:ia,xfdf:"<add>"+ha+"</add>"})):"modify"===a?(ka=n.querySelector('[name="'+ba.Id+'"]'),ha=h.serializeToString(ka),f.annots.push({at:"modify",aId:ba.Id,xfdf:"<modify>"+
ha+"</modify>"})):"delete"===a&&f.annots.push({at:"delete",aId:ba.Id});0<f.annots.length&&r.connection.send(f);return[2]}})})}.bind(r);this.Da.addEventListener(ca.a.Events.ANNOTATION_CHANGED,this.Hi)};z.Events={WEBVIEWER_SERVER_ANNOTATIONS_ENABLED:"webViewerServerAnnotationsEnabled",WEBVIEWER_SERVER_ANNOTATIONS_DISABLED:"webViewerServerAnnotationsDisabled"};return z}();Object(Ca.a)(aa);va["default"]=aa}}]);}).call(this || window)
